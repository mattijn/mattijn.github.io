<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="nl" xml:lang="nl"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mattijn van Hoek">
<meta name="dcterms.date" content="2024-04-22">

<title>mattijn.github.io - De 🌀 Tegeltijdportaal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Geen resultaten",
    "search-matching-documents-text": "Gevonden documenten",
    "search-copy-link-title": "Kopieer link om te zoeken",
    "search-hide-matches-text": "Extra overeenkomsten verbergen",
    "search-more-match-text": "meer overeenkomst in dit document",
    "search-more-matches-text": "meer overeenkomsten in dit document",
    "search-clear-button-title": "Wissen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuleren",
    "search-submit-button-title": "Verzenden",
    "search-label": "Zoeken"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">mattijn.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Zoeken"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Schakel navigatie" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">De 🌀 <em>Tegeltijdportaal</em></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Auteur</div>
      <div class="quarto-title-meta-contents">
               <p>Mattijn van Hoek </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Publicatiedatum</div>
      <div class="quarto-title-meta-contents">
        <p class="date">22 april 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="de-tegeltijdportaal" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="de-tegeltijdportaal">De 🌀 <em>Tegeltijdportaal</em></h2>
<p>Binnen de tegeltijdportaal maken we het mogelijk om het tijdsverloop van elke locatie in Nederland te zien met zeer hoge resolutie satellietdata. Dit doen we door gebruik te maken van voorgerenderde tegels vanuit het satellietdataportaal. Hiermee krijg je snel inzicht in de dynamiek van locaties. In dit artikel duiken we dieper in op welke manier we deze informatie inzichtelijk maken.</p>
<p>Dit doen we in 3 stappen, namelijk:</p>
<ul>
<li>Wat bedoelen we met een 🔲 <em>Tegel definitie</em>?</li>
<li>Hoe werkt de 🌀 <em>Tegeltijdportaal</em>?</li>
<li>Op welke manier is <img style="width:15px;" src="solara.png"> <em>Solara</em> gebruikt?</li>
</ul>
<section id="wat-bedoelen-we-met-een-tegel-definitie" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="wat-bedoelen-we-met-een-tegel-definitie">Wat bedoelen we met een 🔲 <em>Tegel definitie</em>?</h3>
<p>De nog altijd fascinerende tiendesprongen van Kees Boeke zijn je vast bekend sinds er in 1977 een film voor IBM werd gemaakt onder de naam <em>Powers of Ten</em>. <img src="powers_of_ten.png" alt="powers of ten" width="100%"></p>
<p>Het laat een picknickend gezin zien in de haven van Chicago waar de camera steeds verder uitzoomt tot het hele universum te zien is, waarnaar het vervolgens weer inzoomt.<br>
Waar de film vooral gaat over het begrip van de machten van 10 en de relatieve verhoudingen tussen kosmisch en microscopisch niveau is, gaat het mij hier nu vooral over het concept dat je een bepaalde mate van detail ziet op een bepaald zoom niveau, ondanks dat het beeld wel een vaste afmeting heeft.</p>
<p>De satellietdata welke wordt ingekocht vanuit het satellietdataportaal heeft een hoge ruimtelijke resolutie. Recente opnames hebben bijvoorbeeld al een ruimtelijke resolutie van 30 centimeter. Om deze hele hoge resolutie fotos toegankelijker te maken gaan we de beelden net als de in de docu van de <em>Power of Ten</em> op delen in vaste zoomlevels. En op elk zoomlevel maken we tegels met vaste afmetingen. Op deze manier blijft een tegel altijd een vaste afmeting hebben, maar al naar gelang het gekozen zoomlevel zie je een hogere of lagere mate van detail.</p>
<p><img src="localtileserver.gif" alt="drawing" width="400"></p>
<p>Het tegelschema of protocol <em>WebMercatorQuad</em> is zo’n manier om de aarde in kleine vierkante rasters of tegels te verdelen. Elke heeft een vaak een vaste afmeting van 256x256 pixels. En elk zoomlevel heeft daarmee zijn eigen vooraf gedefinieerde ruimtelijke resolutie. PDOK heeft de volgende <a href="https://api.pdok.nl/lv/bag/ogc/v1_0/tileMatrixSets/WebMercatorQuad">tabel</a> beschikbaar om hier iets meer duiding aan te geven:</p>
<div id="349fddf9-16f9-4850-b806-f62e96ddad23" class="cell page-columns page-full" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(<span class="st">'https://api.pdok.nl/lv/bag/ogc/v1_0/tileMatrixSets/WebMercatorQuad?f=json'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pd.DataFrame.from_dict(r.json()[<span class="st">'tileMatrices'</span>]).set_index(<span class="st">'id'</span>)</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-screen" data-execution_count="1">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tileWidth</th>
<th data-quarto-table-cell-role="th">tileHeight</th>
<th data-quarto-table-cell-role="th">matrixWidth</th>
<th data-quarto-table-cell-role="th">matrixHeight</th>
<th data-quarto-table-cell-role="th">scaleDenominator</th>
<th data-quarto-table-cell-role="th">cellSize</th>
<th data-quarto-table-cell-role="th">pointOfOrigin</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>256</td>
<td>256</td>
<td>1</td>
<td>1</td>
<td>5.590823e+08</td>
<td>156543.033928</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>256</td>
<td>256</td>
<td>2</td>
<td>2</td>
<td>2.795411e+08</td>
<td>78271.516964</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>256</td>
<td>256</td>
<td>4</td>
<td>4</td>
<td>1.397706e+08</td>
<td>39135.758482</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>256</td>
<td>256</td>
<td>8</td>
<td>8</td>
<td>6.988528e+07</td>
<td>19567.879241</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>256</td>
<td>256</td>
<td>16</td>
<td>16</td>
<td>3.494264e+07</td>
<td>9783.939621</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>256</td>
<td>256</td>
<td>32</td>
<td>32</td>
<td>1.747132e+07</td>
<td>4891.969810</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>256</td>
<td>256</td>
<td>64</td>
<td>64</td>
<td>8.735660e+06</td>
<td>2445.984905</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>256</td>
<td>256</td>
<td>128</td>
<td>128</td>
<td>4.367830e+06</td>
<td>1222.992453</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>256</td>
<td>256</td>
<td>256</td>
<td>256</td>
<td>2.183915e+06</td>
<td>611.496226</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>256</td>
<td>256</td>
<td>512</td>
<td>512</td>
<td>1.091958e+06</td>
<td>305.748113</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>256</td>
<td>256</td>
<td>1024</td>
<td>1024</td>
<td>5.459788e+05</td>
<td>152.874057</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>256</td>
<td>256</td>
<td>2048</td>
<td>2048</td>
<td>2.729894e+05</td>
<td>76.437028</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>256</td>
<td>256</td>
<td>4096</td>
<td>4096</td>
<td>1.364947e+05</td>
<td>38.218514</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>256</td>
<td>256</td>
<td>8192</td>
<td>8192</td>
<td>6.824735e+04</td>
<td>19.109257</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>256</td>
<td>256</td>
<td>16384</td>
<td>16384</td>
<td>3.412367e+04</td>
<td>9.554629</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>256</td>
<td>256</td>
<td>32768</td>
<td>32768</td>
<td>1.706184e+04</td>
<td>4.777314</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>256</td>
<td>256</td>
<td>65536</td>
<td>65536</td>
<td>8.530918e+03</td>
<td>2.388657</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>256</td>
<td>256</td>
<td>131072</td>
<td>131072</td>
<td>4.265459e+03</td>
<td>1.194329</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>256</td>
<td>256</td>
<td>262144</td>
<td>262144</td>
<td>2.132730e+03</td>
<td>0.597164</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>256</td>
<td>256</td>
<td>524288</td>
<td>524288</td>
<td>1.066365e+03</td>
<td>0.298582</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>256</td>
<td>256</td>
<td>1048576</td>
<td>1048576</td>
<td>5.331824e+02</td>
<td>0.149291</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>256</td>
<td>256</td>
<td>2097152</td>
<td>2097152</td>
<td>2.665912e+02</td>
<td>0.074646</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>256</td>
<td>256</td>
<td>4194304</td>
<td>4194304</td>
<td>1.332956e+02</td>
<td>0.037323</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>256</td>
<td>256</td>
<td>8388608</td>
<td>8388608</td>
<td>6.664780e+01</td>
<td>0.018661</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>256</td>
<td>256</td>
<td>16777216</td>
<td>16777216</td>
<td>3.332390e+01</td>
<td>0.009331</td>
<td>[-20037508.3427892, 20037508.3427892]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Meer info over deze 2 dimensionale tile matrix set standaard is ook te vinden via <a href="https://docs.ogc.org/is/17-083r2/17-083r2.html">de website van OGC</a>. En daarnaast <a href="https://www.youtube.com/watch?v=1hiPoTFn1CA">deze video-presentatie</a> van Jachym hoe je om kan gaan met grote hoeveelheden raster data via tegel definities met onder andere open source sofware.</p>
<p>Om iets meer gevoel te krijgen met het effect van de zoom niveaus kan je de slider in het volgende figuur heen en weer bewegen. Het laat, gegeven een zoom level, zien hoe groot een tegel is voor het inliggende coordinaat van 🌍 <em>Locatie</em> HKV in Amersfoort.</p>
<div id="fa72aca9-648c-4ee8-a14a-1ea73cda6094" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>gdf_tile <span class="op">=</span> gpd.read_file(<span class="st">'zoom_tegel_HKV_amersfoort.geo.json'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># topologisch gesimplificeerd met https://github.com/mattijn/topojson</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>gdf_prov <span class="op">=</span> gpd.read_file(<span class="st">'provincies_2023.simp.geo.json'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>xmin, ymin, xmax, ymax <span class="op">=</span> gdf_prov.total_bounds</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># fit object should be a GeoJSON-like Feature or FeatureCollection</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>extent_NL <span class="op">=</span> {<span class="st">"type"</span>: <span class="st">"Feature"</span>, <span class="st">"geometry"</span>: {<span class="st">"type"</span>: <span class="st">"Polygon"</span>, <span class="st">"coordinates"</span>: [[[xmax, ymax], [xmax, ymin], [xmin, ymin], [xmin, ymax], [xmax, ymax]]]}, <span class="st">"properties"</span>: {}}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>slider <span class="op">=</span> alt.binding_range(<span class="bu">min</span><span class="op">=</span><span class="dv">8</span>, <span class="bu">max</span><span class="op">=</span><span class="dv">17</span>, step<span class="op">=</span><span class="dv">1</span>, name<span class="op">=</span><span class="st">'zoom level'</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> alt.param(bind<span class="op">=</span>slider, value<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.layer(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    alt.Chart(gdf_prov).mark_geoshape(filled<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    alt.Chart().mark_circle(color<span class="op">=</span><span class="st">'black'</span>).encode(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        latitude<span class="op">=</span>alt.datum(<span class="fl">52.1515</span>), </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        longitude<span class="op">=</span>alt.datum(<span class="fl">5.3790</span>),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        href<span class="op">=</span>alt.value(<span class="st">'https://www.hkv.nl'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    alt.Chart(gdf_tile).mark_geoshape(fill<span class="op">=</span><span class="st">'orange'</span>, opacity<span class="op">=</span><span class="fl">0.8</span>).transform_filter(alt.datum.zoom_level <span class="op">==</span> <span class="bu">filter</span>),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    alt.Chart(gdf_tile).mark_geoshape(clip<span class="op">=</span><span class="va">True</span>, filled<span class="op">=</span><span class="va">False</span>, stroke<span class="op">=</span><span class="st">'black'</span>, strokeWidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>).project(<span class="bu">type</span><span class="op">=</span><span class="st">'mercator'</span>, fit<span class="op">=</span>extent_NL).add_params(<span class="bu">filter</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>chart</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DriverError: zoom_tegel_HKV_amersfoort.geo.json: No such file or directory</code></pre>
</div>
</div>
<p>In oranje zie je de daadwerkelijke tegel op het gekozen zoom nivea met het inliggende coordinaat van 🌍 <em>Locatie</em> HKV in Amersfoort en zwart omlijnt zie je de range aan tegels voor de verschillende zoom niveaus van deze coordinaat. Voor een kaart met geheel Nederland in beeld zijn de tegels vanaf level 16 niet meer zichtbaar op deze kaart. Om de inhoud van deze tegels te tonen zul je eerst verder moeten inzoomen op het interesse gebied.</p>
<p>Zoals je ziet volgen de tegels een vaste volgordelijkheid. Een specifieke locatie is daarmee altijd gekoppeld aan een eenzelfde tegel gegeven het zoom niveau. Zoals gezegd heeft de inhoud van elke tegel steeds een vaste afmeting. In ons geval is dit 256 x 256 pixels.</p>
<p>Binnen het SBIR project met het thema biodiversiteit, subthema: natuur werken wij, vanuit het satellietataportaal, met tegels op 🔍 <em>Zoomlevel</em> 17. Deze tegels bevatten daarmee de data op het resolutie niveau die wij voor de gekozen toepassing toepasselijk vinden.</p>
<p>Al met al is een gegeven 🔲 <em>Tegel definitie</em> dus een combinatie van een 🌍 <em>Locatie</em> en een 🔍 <em>Zoomlevel</em>.</p>
</section>
<section id="hoe-werkt-de-tegeltijdportaal" class="level3">
<h3 class="anchored" data-anchor-id="hoe-werkt-de-tegeltijdportaal">Hoe werkt de 🌀 <em>Tegeltijdportaal</em>?</h3>
<p>Nu we weten wat een 🔲 <em>Tegel definitie</em> is, laten we iets meer ingaan op welke manier we dit koppelen aan de services binnen het satellietdataportaal. We beginnen met een schematische weergave van de de applicatie, die we vervolgens in stapjes, met bijbehorende code uitwerken.</p>
<p>De applicatie werkt als volgt (voor simplificatie negeren we de quadkey als invoer):</p>
<pre class="mermaid"><code>graph TB
    style invoer fill:#f0f0f0,stroke:#333,stroke-width:2px
    style tussenstap fill:#f0f0f0,stroke:#333,stroke-width:2px
    style uitvoer fill:#f0f0f0,stroke:#333,stroke-width:2px

    style in1 fill:#ffff,stroke:#333,stroke-width:1px
    style in2 fill:#ffff,stroke:#333,stroke-width:1px
    style in3 fill:#ffff,stroke:#333,stroke-width:1px    
    style in4 fill:#ffff,stroke:#333,stroke-width:1px
    style int2 fill:#ffff,stroke:#333,stroke-width:1px    
    style int3 fill:#ffff,stroke:#333,stroke-width:1px        
    style out1 fill:#ffff,stroke:#333,stroke-width:1px

    style int1 fill:#F8D664,stroke:#333,stroke-width:1px
    style out2 fill:#F8D664,stroke:#333,stroke-width:1px

    subgraph invoer

        in1[🌍 Locatie]
        in2[📏 Sensor resolutie]
        in3[🔍 Zoomlevel]
        in4[🎨 Kleuren composiet]  
    
    end
   
    subgraph tussenstap
        
        int1[⚙️ Index service satellietdataportaal]
        int2[🔲 Tegel definitie]
        int3[⏱️ Beschikbaarheid opnamen]
        int4[📑 Collectie tegels]
    end
  
    subgraph uitvoer
        
        out1[📊 Tegeltijdgrafiek]
        out2[⚙️ Tegel service satellietdataportaal]
    end
    in1 --&gt; int1
    in2 --&gt; int1
    in3 --&gt; int2
    in1 --&gt; int2    
    in4 --&gt; int3
    

    int1 --&gt; int3
    int2 --&gt; int3
    int3 --&gt; int4    
    int4 --&gt; out1

    out1 --&gt; out2 --&gt; out1   </code></pre>
<p>Laten we beginnen met het bevragen van de ⚙️ <em>Index service satellietdataportaal</em> met de 🌍 <em>Locatie</em> en de 📏 <em>Sensor resolutie</em> input.</p>
<div id="75ca42bf-1687-4bc2-b933-db36d1fee4f6" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> index_service_satellietdataportaal(longitude, latitude, resolutions):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="st">"https://www.satellietdataportaal.nl/wp-admin/admin-ajax.php"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    post_data <span class="op">=</span> [</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'action'</span>, <span class="st">'sdp_api'</span>), </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'searchObject[geometry][type]'</span>, <span class="st">'Point'</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'searchObject[geometry][coordinates][]'</span>, longitude),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'searchObject[geometry][coordinates][]'</span>, latitude)       </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> resolution <span class="kw">in</span> resolutions:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        post_data.append((<span class="st">'searchObject[properties][filters][resolutionfilter][eq][]'</span>, resolution))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {<span class="st">'content-type'</span>: <span class="st">'application/x-www-form-urlencoded;charset=UTF-8'</span>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.post(url<span class="op">=</span>url, data<span class="op">=</span>post_data, headers<span class="op">=</span>headers)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    feats <span class="op">=</span> r.json()[<span class="st">'data'</span>][<span class="st">'features'</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> feats:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gpd.GeoDataFrame()    </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gpd.GeoDataFrame.from_features(feats)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We maken gebruik van een <code>index_service_satellietdataportaal</code> functie. Dit retourneert een geopandas GeoDataFrame gegeven een input op basis van longitude, latitude en gewenste resoluties. De 🌍 <em>Locatie</em> geven we op in decimale graden en de 📏 <em>Sensor resolutie</em> in meters.</p>
<div id="f5f9738f-ef14-4655-b134-9e51a065b014" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="fl">5.3790</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">52.1515</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>resolutions <span class="op">=</span> [<span class="fl">0.3</span>, <span class="fl">0.5</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>gdf_layers <span class="op">=</span> index_service_satellietdataportaal(longitude, latitude, resolutions)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>gdf_layers.head()</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Zoals je kunt zien bevat dit informatie over de de datum en tijd van acquisitie, naam van de sensor en de resolutie die toebehoort tot de resolutie en bevat het een kolom met layers. Deze layers koppelen we aan onze gewenste tegel. De tegel definieren we met behulp van onze 🌍 <em>Locatie</em> en 🔍 <em>Zoomlevel</em>. We maken hierbij gebruik van de WebMercatorQuad tegelschema, zoals gezegd in de sectie over de 🔲 <em>Tegel definitie</em>.</p>
<p>Daarnaast heeft het satellietdataportaal twee mogelijkheden voor een 🎨 <em>Kleuren composiet</em>. In ons geval maken wij gebruik van het vals kleuren composiet, waarbij we wel gebruiken maken van de nabij-infrarode band, rode band, en groene band, maar niet van de blauwe band. In het satellietdataportaal heet dit 🎨 <em>Kleuren composiet</em> <code>IRG</code>. Laten we onze opgevraagde layers verder opwerken om de gewenste 📑 <em>Collectie tegels</em> aan te maken.</p>
<div id="d497225a-a612-4961-82f4-6cd36a85b238" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tile_collection(df, tile, composite):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"layers"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"tile_link"</span>] <span class="op">=</span> [<span class="bu">next</span>((layer[<span class="st">"tile_link"</span>] <span class="cf">for</span> layer <span class="kw">in</span> layers <span class="cf">if</span> layer[<span class="st">"composite"</span>] <span class="op">==</span> composite), <span class="va">None</span>) <span class="cf">for</span> layers <span class="kw">in</span> df[<span class="st">"layers"</span>]]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"image"</span>] <span class="op">=</span> [uri.<span class="bu">format</span>(z<span class="op">=</span>tile.z, x<span class="op">=</span>tile.x, y<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>tile<span class="sc">.</span>y<span class="sc">}</span><span class="ss">.png'</span>) <span class="cf">for</span> uri <span class="kw">in</span> df[<span class="st">"tile_link"</span>]]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">"id"</span>, <span class="st">"acquisitiondate"</span>, <span class="st">"resolution"</span>, <span class="st">"sensorname"</span>, <span class="st">"image"</span>, <span class="st">"tile_link"</span>]]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We maken gebruik van een <code>tile_collection</code> functie. Dit retourneert een pandas DataFrame gegeven de GeoDataFrame met layers, een 🔲 <em>Tegel definitie</em>, en het gewenste 🎨 <em>Kleuren composiet</em>.</p>
<div id="78af1473-db52-4a8d-93d8-4c880fed42a5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>composite <span class="op">=</span> <span class="st">'IRG'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tile <span class="op">=</span> mercantile.tile(longitude, latitude, zoom<span class="op">=</span><span class="dv">17</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_tiles <span class="op">=</span> tile_collection(gdf_layers, tile, composite)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df_tiles.head()</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'mercantile' is not defined</code></pre>
</div>
</div>
<p>Onze 📑 <em>Collectie tegels</em> in de vorm van een pandas DataFrame geven we weer met een Vega-Altair grafiek.</p>
<div id="871a12d7-74bb-4b8a-a893-5ae5d0e4251e" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>highlight <span class="op">=</span> alt.selection_point(on<span class="op">=</span><span class="st">'mouseover'</span>, empty<span class="op">=</span><span class="va">False</span>, nearest<span class="op">=</span><span class="va">False</span>, encodings<span class="op">=</span>[<span class="st">'x'</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> alt.Chart(df_tiles, height<span class="op">=</span><span class="dv">75</span>, width<span class="op">=</span>alt.Step(<span class="dv">15</span>)).mark_bar(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    opacity<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    strokeWidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    cursor<span class="op">=</span><span class="st">'pointer'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    cornerRadius<span class="op">=</span><span class="dv">15</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'acquisitiondate:N'</span>).axis(formatType<span class="op">=</span><span class="st">'time'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).title(<span class="va">None</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span>alt.Fill(<span class="st">'sensor_resolution:N'</span>).legend(orient<span class="op">=</span><span class="st">'top'</span>).sort(field<span class="op">=</span><span class="st">'resolution'</span>, op<span class="op">=</span><span class="st">'max'</span>, order<span class="op">=</span><span class="st">'ascending'</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    stroke<span class="op">=</span>alt.condition(highlight, alt.value(<span class="st">'black'</span>), alt.value(<span class="st">'transparent'</span>)), </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>alt.Tooltip([<span class="st">'image'</span>]),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    order<span class="op">=</span>alt.Order(<span class="st">'resolution:Q'</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>).transform_calculate(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    sensor_resolution<span class="op">=</span>alt.datum.sensorname <span class="op">+</span> <span class="st">" ("</span> <span class="op">+</span> alt.datum.resolution <span class="op">+</span> <span class="st">"m)"</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>).add_params(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    highlight</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>chart</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Op de x-as zien we alle datums waarop een uniek satelliet-opname beschikbaar is van de locatie. De kleuren geven aan met welke satelliet-sensor de opname gemaakt is. Recentere opnamen hebben een hogere resolutie. Op dit moment koopt GeoServe namens NSO beelden in met een ruimtelijke resolutie van 0.3 meter van Pleiades-NEO, een satelliet-constellatie van Airbus.</p>
<p>Wanneer je met je muis over de staven heen beweegt licht er in de tooltip een afbeelding op van de tegel van de desbetreffende satelliet-opname. De afbeelding wordt on-the-fly opgehaald vanuit de ⚙️ <em>Tegel service satellietdataportaal</em>.</p>
<p>Op deze manier is het mogelijk om met vaste tegelgrootte het tijdsverloop voor een locatie in Nederland gegeven het gewenste detailniveau.</p>
<p>Handig wanneer je specifieke locaties in de gaten wilt houden op een bepaald verloop.</p>
<div id="b4ccd445-f5a9-445e-845f-a4d858df5226" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>alt.Chart(df_tiles, height<span class="op">=</span><span class="dv">100</span>, width<span class="op">=</span>alt.Step(<span class="dv">100</span>)).mark_image().encode(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">"acquisitiondate:N"</span>).axis(formatType<span class="op">=</span><span class="st">'time'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>).title(<span class="va">None</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    url<span class="op">=</span>alt.Url(<span class="st">'image'</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>alt.Tooltip([<span class="st">'image'</span>])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Kopieer naar klembord" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Gekopieerd!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Gekopieerd!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>